<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Send message</title>

    <link rel="stylesheet" href="css/main.css">
</head>
<body>
    <h2>Отправка уведомлений</h2>
    <b>Тестирование отправки уведомлений</b>. Откройте консоль браузера для просмотра результатов операций.<br><br>


    <h4>Отправка</h4>
    <label for="txt">Текст сообщения</label>
    <input id="txt" type="text"  placeholder="текст сообщения" value="Верховный суд разъяснил, чем угон автомобиля отличается от кражи"/>
    <label for="link">Ссылка</label>
    <input id="link" type="text"  placeholder="ссылка" value="https://rg.ru/2020/03/02/verhovnyj-sud-raziasnil-chem-ugon-avtomobilia-otlichaetsia-ot-krazhi.html"/>
    <br><br>

    <button onclick="sendMessage('/topics/rgru', document.getElementById('txt').value, document.getElementById('link').value)">
        Разослать сообщения Подписчикам топика 'rgru'
    </button>
    <br><br>
    <input id="to" type="text" value='' placeholder="токен пользователя" />
    <button onclick="sendMessage(document.getElementById('to').value, document.getElementById('txt').value, document.getElementById('link').value)">Послать сообщение пользователю</button>
    
    
    <br><br><br><br>



    <h4>Подписка</h4>
    <input id="token" type="text" value='' placeholder="токен для подписки" />
    <button onclick="subscribeToRGRU(document.getElementById('token').value)">Подписать токен на 'rgru'</button>
    <button onclick="unsubscribeFromRGRU(document.getElementById('token').value)" class="button-outline">Отписать токен от 'rgru'</button>



    <h4>Отправленные сообщения</h4>

    <script src="js/fcm-server-key.js"></script>
    <script src="js/send-message.js"></script>
    <script>

        function subscribeToRGRU(token) {
            fetch('http://localhost:5001/rg-push/us-central1/subscribeIIDToRGRU?iid='+token)
                .then(res => res.json())
                .then(json => console.log(json))
                .catch(err => console.log("ERROR:",err))
        }

        function unsubscribeFromRGRU(token) {
            fetch('http://localhost:5001/rg-push/us-central1/unsubscribeIIDFromRGRU?iid='+token)
                .then(res => res.json())
                .then(json => console.log(json))
                .catch(err => console.log("ERROR:",err))
        }

    </script>

</body>
</html>